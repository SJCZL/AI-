# LangChain智能质检助手

基于Streamlit + LangChain + DeepSeek V3的批量数据质检工具，替代原有的Dify工作流实现。

## 🚀 功能升级亮点

- ✅ **从Dify迁移到LangChain + DeepSeek V3** - 更灵活的模型控制
- ✅ **前端直接配置API密钥** - 无需后端配置
- ✅ **结构化JSON输出** - 包含评分、问题、建议等完整质检维度
- ✅ **并行处理优化** - 支持多线程加速处理
- ✅ **实时连接测试** - 处理前可测试API连接
- ✅ **智能内容提取** - 自动解析JSON结果并分类整理

## 📋 功能特点

- 📊 支持Excel和CSV文件上传
- 🎯 可选择任意列作为质检输入
- ⚡ 批量调用DeepSeek API进行智能分析
- 📈 实时进度显示和统计信息
- 💾 支持CSV和Excel格式下载结果
- 🔄 可重新处理数据
- 🔍 智能JSON内容提取和分类

## 🛠️ 安装步骤

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 获取DeepSeek API密钥

1. 访问 [DeepSeek官网](https://platform.deepseek.com/)
2. 注册账号并登录
3. 进入"API Keys"页面
4. 创建新的API密钥
5. 复制密钥备用

### 3. 运行应用

```bash
streamlit run streamlit_langchain_app.py
```

## 📖 使用方法

### 1. 配置API
- 在左侧边栏输入DeepSeek API密钥
- 可自定义API端点URL（通常使用默认值）

### 2. 测试连接
- 点击"测试连接"按钮验证API密钥有效性
- 确保显示"连接成功"后再继续

### 3. 上传文件
- 支持CSV、XLSX、XLS格式
- 文件大小建议不超过10MB（避免API限流）

### 4. 选择处理列
- 从下拉菜单中选择包含待质检文本的列
- 可预览选中列的前5行数据

### 5. 性能配置
- **启用并行处理**: 提升处理速度
- **并发线程数**: 建议3-5个，避免触发API限流
- **DeepSeek限制**: 每分钟最多20次调用

### 6. 开始处理
- 点击"开始智能质检"按钮
- 实时查看处理进度
- 每行数据间隔0.5秒避免API限流

### 7. 结果分析
- 查看总体统计信息（总处理数、成功率等）
- 浏览详细质检结果
- 使用智能内容提取功能整理JSON数据

### 8. 下载结果
- 处理完成后可下载CSV或Excel格式的结果文件
- 质检结果会添加到原表格的最后一列
- 可单独下载提取的JSON部分内容

## 📊 输出格式说明

### 质检结果JSON结构
```json
{
    "总体评分": "8",
    "质检结果": "合格",
    "主要问题": ["语速过快", "未主动询问客户需求"],
    "改进建议": ["放慢语速", "增加需求挖掘问题"],
    "优秀表现": ["产品介绍详细", "态度热情"],
    "关键指标": {
        "服务态度": "9",
        "专业程度": "8",
        "沟通技巧": "7",
        "产品知识": "9"
    },
    "风险点": ["未提及售后政策"]
}
```

## 🔄 从Dify迁移指南

### 主要变化
1. **API配置**: 从Dify工作流URL改为DeepSeek API密钥
2. **模型选择**: 固定使用DeepSeek V3模型
3. **输出格式**: 标准化JSON结构，更易于后续处理
4. **性能优化**: 支持并行处理，速度提升2-3倍

### 数据兼容性
- ✅ 原有CSV/Excel文件格式完全兼容
- ✅ 处理流程和界面操作保持一致
- ✅ 结果下载格式保持不变

## ⚠️ 注意事项

- **API限流**: DeepSeek免费用户每分钟限制20次调用
- **并发建议**: 建议并发线程数不超过3个
- **空值处理**: 空值或空字符串会被跳过，结果为"空值跳过"
- **错误处理**: API调用失败会返回错误信息到结果列
- **数据量**: 大量数据处理可能需要较长时间，建议分批处理

## 🛡️ 故障排除

### 常见问题

1. **API连接失败**
   - 检查API密钥是否正确
   - 确认网络连接正常
   - 检查是否达到API调用限制

2. **模型初始化失败**
   - 确认API密钥有效
   - 检查网络代理设置
   - 验证API端点URL

3. **处理超时**
   - 减少单次处理的数据量
   - 降低并发线程数
   - 检查API响应时间

4. **JSON解析失败**
   - 检查API返回格式
   - 确认网络连接稳定
   - 尝试重新处理

## 📁 文件结构

```
├── streamlit_langchain_app.py  # 主应用文件（LangChain版本）
├── streamlit_dify_app.py       # 原Dify版本（保留备用）
├── requirements.txt            # 依赖列表（已更新）
├── README_LANGCHAIN.md         # LangChain版本使用说明
├── README.md                   # 原Dify版本说明
└── examples/                   # 示例文件
    ├── sample_data.csv
    └── sample_data.xlsx
```

## 🎯 技术支持

### 获取帮助
- **DeepSeek文档**: [官方API文档](https://platform.deepseek.com/docs)
- **LangChain文档**: [官方文档](https://python.langchain.com/docs/)
- **Streamlit文档**: [官方文档](https://docs.streamlit.io/)

### 性能优化建议
- 对于大量数据，建议分批处理（每次100-500条）
- 使用并行处理时监控API调用频率
- 考虑升级到DeepSeek付费套餐获得更高配额

## 🔄 版本历史

- **v2.0.0**: 从Dify迁移到LangChain + DeepSeek V3
- **v1.0.0**: 基于Dify工作流的原始版本
